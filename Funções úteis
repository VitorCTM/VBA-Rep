Funções úteis VBA
-----------------

Function EncontrarCoisas(byVal coisa as String/Integer/Variant/Etc, byVal intervaloBusca as Range, byVal worksheetName as String) as String/Integer/Variant/Etc
	'Utiliza o "Localizar" do excel para encontrar qualquer coisa na planilha. Muito mais rápido do que rodar célula a célula com um loop for/while.
	
	dim resultado as Range

	With Worksheets(worksheetName).Range(intervaloBusca)
        	Set resultado = .Find(What:=coisa, LookIn:=xlFormulas, LookAt:=xlPart(/xlWhole), SearchOrder:=xlByRows(/xlbyColumns), SearchDirection:=xlNext, MatchCase:=False(/True), SearchFormat:=False)
	End With

	EncontrarCoisas = resultado.value	'Alternativamente, pode ser retornado a linha (resultado.row), coluna (resultado.column) etc.
End Function

'===========================================

Function IsTime(ByVal horario) As Boolean
	'Utiliza regex para determinar se o valor passado para a função é um valor de tempo.

	Dim regex As Object
	Set regex = CreateObject("VBScript.RegExp")
    
	regex.Pattern = "^([0-1][0-9])|(2[0-4]):[0-5][0-9]:[0-5][0-9]$"
    
	IsTime = regex.test(x)
End Function

'===========================================

Function UltimaLinhaPreenchida(ByVal worksheetName as String, ByVal linhaFinal as Double, Optional ByVal colunaStr as String, Optional ByVal colunaNum as Double) as Double
	'Retorna a última linha que possui dados em uma determinada coluna de uma aba da planilha.
	'Devem ser passados de parâmetro o nome da aba, a coluna usada como referência para preenchimento e a coluna, que pode ser em formato de letra ou número.
	'Informar a coluna é opcional. Caso nenhum valor seja informado, a planilha vai retornar a última linha preenchida da coluna A (1).
	'O parâmetro última linha determina onde será iniciada a busca. Se uma aba tiver as linhas 1-10 e 18-24 preenchidas, colocar 15 nesse parâmetro vai retornar 10, enquanto colocar 50 vai retornar 24.

	dim rangeStr as String

	if (colunaStr = "") And (colunaNum = 0)
		colunaNum = 1
	end if
	if colunaStr <> "" then
		rangeStr = colunaStr & linhaFinal
		UltimaLinhaPreenchida = Worksheets(worksheetName).Range(rangeStr).End(xlUp).Row
	elseif colunaNum > 0 then
		UltimaLinhaPreenchida = Worksheets(worksheetName).Range(Worksheets(worksheetName).Rows.Count, colunaNum).End(xlUp).Row
	else
		colunaNum = 1
		UltimaLinhaPreenchida = Worksheets(worksheetName).Range(Worksheets(worksheetName).Rows.Count, colunaNum).End(xlUp).Row
	end if
End Function
